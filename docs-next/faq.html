<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js coal">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>F.A.Q. - DipDup Documentation</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">
        <link rel="stylesheet" href="mdbook-admonish.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <!-- NOTE: Fixed coal -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "coal";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('coal')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="quickstart.html"><strong aria-hidden="true">1.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting-started/installation.html"><strong aria-hidden="true">2.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="getting-started/core-concepts.html"><strong aria-hidden="true">2.2.</strong> Core concepts</a></li><li class="chapter-item expanded "><a href="getting-started/creating-config.html"><strong aria-hidden="true">2.3.</strong> Creating config</a></li><li class="chapter-item expanded "><a href="getting-started/project-package.html"><strong aria-hidden="true">2.4.</strong> Project package</a></li><li class="chapter-item expanded "><a href="getting-started/defining-models.html"><strong aria-hidden="true">2.5.</strong> Defining models</a></li><li class="chapter-item expanded "><a href="getting-started/implementing-handlers.html"><strong aria-hidden="true">2.6.</strong> Implementing handlers</a></li><li class="chapter-item expanded "><a href="getting-started/templates-and-variables.html"><strong aria-hidden="true">2.7.</strong> Templates and variables</a></li></ol></li><li class="chapter-item expanded "><a href="indexes/index.html"><strong aria-hidden="true">3.</strong> Indexes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="indexes/evm_subsquid_events.html"><strong aria-hidden="true">3.1.</strong> evm.subsquid.events</a></li><li class="chapter-item expanded "><a href="indexes/tezos_tzkt_big_maps.html"><strong aria-hidden="true">3.2.</strong> tezos.tzkt.big_maps</a></li><li class="chapter-item expanded "><a href="indexes/tezos_tzkt_events.html"><strong aria-hidden="true">3.3.</strong> tezos.tzkt.events</a></li><li class="chapter-item expanded "><a href="indexes/tezos_tzkt_head.html"><strong aria-hidden="true">3.4.</strong> tezos.tzkt.head</a></li><li class="chapter-item expanded "><a href="indexes/tezos_tzkt_operations.html"><strong aria-hidden="true">3.5.</strong> tezos.tzkt.operations</a></li><li class="chapter-item expanded "><a href="indexes/tezos_tzkt_operations_unfiltered.html"><strong aria-hidden="true">3.6.</strong> tezos.tzkt.operations_unfiltered</a></li><li class="chapter-item expanded "><a href="indexes/tezos_tzkt_token_transfers.html"><strong aria-hidden="true">3.7.</strong> tezos.tzkt.token_transfers</a></li></ol></li><li class="chapter-item expanded "><a href="datasources/index.html"><strong aria-hidden="true">4.</strong> Datasources</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="datasources/abi_etherscan.html"><strong aria-hidden="true">4.1.</strong> abi.etherscan</a></li><li class="chapter-item expanded "><a href="datasources/coinbase.html"><strong aria-hidden="true">4.2.</strong> coinbase</a></li><li class="chapter-item expanded "><a href="datasources/evm_node.html"><strong aria-hidden="true">4.3.</strong> evm.node</a></li><li class="chapter-item expanded "><a href="datasources/evm_subsquid.html"><strong aria-hidden="true">4.4.</strong> evm.subsquid</a></li><li class="chapter-item expanded "><a href="datasources/http.html"><strong aria-hidden="true">4.5.</strong> http</a></li><li class="chapter-item expanded "><a href="datasources/ipfs.html"><strong aria-hidden="true">4.6.</strong> ipfs</a></li><li class="chapter-item expanded "><a href="datasources/tezos_tzkt.html"><strong aria-hidden="true">4.7.</strong> tezos.tzkt</a></li><li class="chapter-item expanded "><a href="datasources/tzip_metadata.html"><strong aria-hidden="true">4.8.</strong> tzip_metadata</a></li></ol></li><li class="chapter-item expanded "><a href="graphql/index.html"><strong aria-hidden="true">5.</strong> GraphQL API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="graphql/hasura.html"><strong aria-hidden="true">5.1.</strong> Hasura integration</a></li><li class="chapter-item expanded "><a href="graphql/rest.html"><strong aria-hidden="true">5.2.</strong> REST endpoints</a></li><li class="chapter-item expanded "><a href="graphql/genql.html"><strong aria-hidden="true">5.3.</strong> GenQL</a></li></ol></li><li class="chapter-item expanded "><a href="advanced/index.html"><strong aria-hidden="true">6.</strong> Advanced usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/context.html"><strong aria-hidden="true">6.1.</strong> Callback context (ctx)</a></li><li class="chapter-item expanded "><a href="advanced/hooks.html"><strong aria-hidden="true">6.2.</strong> Hooks</a></li><li class="chapter-item expanded "><a href="advanced/system-hooks.html"><strong aria-hidden="true">6.3.</strong> System hooks</a></li><li class="chapter-item expanded "><a href="advanced/jobs.html"><strong aria-hidden="true">6.4.</strong> Job scheduler</a></li><li class="chapter-item expanded "><a href="advanced/reindexing.html"><strong aria-hidden="true">6.5.</strong> Reindexing</a></li><li class="chapter-item expanded "><a href="advanced/feature-flags.html"><strong aria-hidden="true">6.6.</strong> Feature flags</a></li><li class="chapter-item expanded "><a href="advanced/sql.html"><strong aria-hidden="true">6.7.</strong> SQL scripts</a></li><li class="chapter-item expanded "><a href="advanced/performance.html"><strong aria-hidden="true">6.8.</strong> Improving performance</a></li><li class="chapter-item expanded "><a href="advanced/internal-tables.html"><strong aria-hidden="true">6.9.</strong> Internal tables</a></li><li class="chapter-item expanded "><a href="advanced/index-factories.html"><strong aria-hidden="true">6.10.</strong> Index factories</a></li><li class="chapter-item expanded "><a href="advanced/metadata-interface.html"><strong aria-hidden="true">6.11.</strong> Metadata interface</a></li></ol></li><li class="chapter-item expanded "><a href="deployment/index.html"><strong aria-hidden="true">7.</strong> Deployment and operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deployment/database-engines.html"><strong aria-hidden="true">7.1.</strong> Database engines</a></li><li class="chapter-item expanded "><a href="deployment/docker.html"><strong aria-hidden="true">7.2.</strong> Running in Docker</a></li><li class="chapter-item expanded "><a href="deployment/sentry.html"><strong aria-hidden="true">7.3.</strong> Sentry integration</a></li><li class="chapter-item expanded "><a href="deployment/prometheus.html"><strong aria-hidden="true">7.4.</strong> Prometheus integration</a></li><li class="chapter-item expanded "><a href="deployment/logging.html"><strong aria-hidden="true">7.5.</strong> Logging</a></li><li class="chapter-item expanded "><a href="deployment/backups.html"><strong aria-hidden="true">7.6.</strong> Backup and restore</a></li><li class="chapter-item expanded "><a href="deployment/monitoring.html"><strong aria-hidden="true">7.7.</strong> Monitoring</a></li></ol></li><li class="chapter-item expanded "><a href="faq.html" class="active"><strong aria-hidden="true">8.</strong> F.A.Q.</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">9.</strong> Troubleshooting</a></li><li class="chapter-item expanded affix "><li class="part-title">Examples</li><li class="chapter-item expanded "><a href="examples/demo-projects.html"><strong aria-hidden="true">10.</strong> Demo projects</a></li><li class="chapter-item expanded "><a href="examples/built-with-dipdup.html"><strong aria-hidden="true">11.</strong> Built with DipDup</a></li><li class="chapter-item expanded affix "><li class="part-title">Standalone Services</li><li class="chapter-item expanded "><a href="services/mempool.html"><strong aria-hidden="true">12.</strong> mempool</a></li><li class="chapter-item expanded "><a href="services/metadata.html"><strong aria-hidden="true">13.</strong> metadata</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="cli-reference.html"><strong aria-hidden="true">14.</strong> Command-line reference</a></li><li class="chapter-item expanded "><a href="config/index.html"><strong aria-hidden="true">15.</strong> Config file reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/reference.html"><strong aria-hidden="true">15.1.</strong> Full reference</a></li><li class="chapter-item expanded "><a href="config/advanced.html"><strong aria-hidden="true">15.2.</strong> advanced</a></li><li class="chapter-item expanded "><a href="config/contracts.html"><strong aria-hidden="true">15.3.</strong> contracts</a></li><li class="chapter-item expanded "><a href="config/custom.html"><strong aria-hidden="true">15.4.</strong> custom</a></li><li class="chapter-item expanded "><a href="config/database.html"><strong aria-hidden="true">15.5.</strong> database</a></li><li class="chapter-item expanded "><a href="config/datasources.html"><strong aria-hidden="true">15.6.</strong> datasources</a></li><li class="chapter-item expanded "><a href="config/hasura.html"><strong aria-hidden="true">15.7.</strong> hasura</a></li><li class="chapter-item expanded "><a href="config/hooks.html"><strong aria-hidden="true">15.8.</strong> hooks</a></li><li class="chapter-item expanded "><a href="config/indexes.html"><strong aria-hidden="true">15.9.</strong> indexes</a></li><li class="chapter-item expanded "><a href="config/jobs.html"><strong aria-hidden="true">15.10.</strong> jobs</a></li><li class="chapter-item expanded "><a href="config/logging.html"><strong aria-hidden="true">15.11.</strong> logging</a></li><li class="chapter-item expanded "><a href="config/package.html"><strong aria-hidden="true">15.12.</strong> package</a></li><li class="chapter-item expanded "><a href="config/prometheus.html"><strong aria-hidden="true">15.13.</strong> prometheus</a></li><li class="chapter-item expanded "><a href="config/sentry.html"><strong aria-hidden="true">15.14.</strong> sentry</a></li><li class="chapter-item expanded "><a href="config/spec_version.html"><strong aria-hidden="true">15.15.</strong> spec_version</a></li><li class="chapter-item expanded "><a href="config/templates.html"><strong aria-hidden="true">15.16.</strong> templates</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">What's New</li><li class="chapter-item expanded "><a href="CHANGELOG.html"><strong aria-hidden="true">16.</strong> Changelog</a></li><li class="chapter-item expanded "><a href="release-notes/index.html"><strong aria-hidden="true">17.</strong> Release notes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="release-notes/7.0.0.html"><strong aria-hidden="true">17.1.</strong> 7.0.0</a></li><li class="chapter-item expanded "><a href="release-notes/6.2.0.html"><strong aria-hidden="true">17.2.</strong> 6.2.0</a></li><li class="chapter-item expanded "><a href="release-notes/6.0.0.html"><strong aria-hidden="true">17.3.</strong> 6.0.0</a></li><li class="chapter-item expanded "><a href="release-notes/5.1.0.html"><strong aria-hidden="true">17.4.</strong> 5.1.0</a></li><li class="chapter-item expanded "><a href="release-notes/5.0.0.html"><strong aria-hidden="true">17.5.</strong> 5.0.0</a></li><li class="chapter-item expanded "><a href="release-notes/4.2.0.html"><strong aria-hidden="true">17.6.</strong> 4.2.0</a></li><li class="chapter-item expanded "><a href="release-notes/4.1.0.html"><strong aria-hidden="true">17.7.</strong> 4.1.0</a></li><li class="chapter-item expanded "><a href="release-notes/4.0.0.html"><strong aria-hidden="true">17.8.</strong> 4.0.0</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Community</li><li class="chapter-item expanded "><a href="CONTRIBUTING.html"><strong aria-hidden="true">18.</strong> Contribution guide</a></li><li class="chapter-item expanded "><a href="LICENSE.html"><strong aria-hidden="true">19.</strong> MIT License</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-button">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <div id="theme-list" class="hidden"></div>

                        <script type="text/javascript">
                            var theme_toggle = document.getElementById('theme-toggle');

                            function toggleTheme() {
                                var html = document.querySelector('html');
                                var theme = html.classList.contains('coal') ? 'light' : 'coal';
                                html.classList.remove('light');
                                html.classList.remove('coal');
                                html.classList.add(theme);
                                try { localStorage.setItem('mdbook-theme', theme); } catch(e) { }
                            }

                            theme_toggle.addEventListener('click', toggleTheme);
                        </script>
                        <a class="icon-button" id="stable">stable</a>
                        <a class="icon-button" id="latest">latest</a>
                        <script type="text/javascript">
                            stable_a = document.getElementById("stable");
                            latest_a = document.getElementById("latest");
                            if (window.location.href.includes("docs.")) {
                                stable_a.style.color = "dimgray";
                                latest_a.setAttribute('href', window.location.href.replace('docs.', 'docs-next.'));
                            }
                            else if (window.location.href.includes('docs-next.')) {
                                latest_a.style.color = "dimgray";
                                stable_a.setAttribute('href', window.location.href.replace('docs-next.', 'docs.'));
                            }
                        </script>

                    </div>

                    <div class="menu-title">
                        <img class="logo" src="/theme/header.png" alt="DipDup logo" />
                    </div>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/dipdup-io/dipdup.git" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="faq"><a class="header" href="#faq">F.A.Q</a></h1>
<p>This page contains answers to the most popular questions about DipDup guts. If you landed here - congrats, you're writing a pretty advanced indexer!</p>
<h2 id="how-to-index-similar-but-not-identical-contracts-as-a-single-entity"><a class="header" href="#how-to-index-similar-but-not-identical-contracts-as-a-single-entity">How to index similar but not identical contracts as a single entity?</a></h2>
<p>Multiple contracts can provide the same interface (like FA1.2 and FA2 standard tokens) but have a different storage structure. If you try to use the same typename for them, indexing will fail. However, you can modify typeclasses manually. Modify <code>types/&lt;typename&gt;/storage.py</code> file and comment out unique fields that are not important for your index:</p>
<pre><code class="language-python">class ContractStorage(BaseModel):
    class Config:
        extra = Extra.ignore

    common_ledger: dict[str, str]
    # unique_field_foo: str
    # unique_field_bar: str
</code></pre>
<p>Don't forget <code>Extra.ignore</code> Pydantic hint, otherwise storage deserialization will fail. To restore the original typeclass, remove modified file and run <code>dipdup init</code> again. You can also add <code>--force</code> flag to overwrite all ABIs and typeclasses.</p>
<h2 id="how-to-use-off-chain-datasources"><a class="header" href="#how-to-use-off-chain-datasources">How to use off-chain datasources?</a></h2>
<p>DipDup provides convenient helpers to process off-chain data like market quotes or IPFS metadata. Follow the tips below to use them most efficiently.</p>
<ul>
<li>Do not perform off-chain requests in handers until necessary. Handlers need to be as fast as possible not to block the database transaction. Use hooks instead, enriching indexed data on-demand.</li>
<li>Use generic <code>http</code> datasource for external APIs instead of plain <code>aiohttp</code> requests. It makes available the same features DipDup uses for internal requests: retry with backoff, rate limiting, Prometheus integration etc.</li>
<li>Database tables that store off-chain data can be marked as immune, to speed up reindexing.</li>
</ul>
<div id="admonition-see-also" class="admonition info">
<div class="admonition-title">
<p>See Also</p>
<p><a class="admonition-anchor-link" href="#admonition-see-also"></a></p>
</div>
<div>
<ul>
<li><a href="https://docs-next.dipdup.io/advanced/jobs.html">6.4. Job scheduler</a></li>
<li><a href="https://docs-next.dipdup.io/datasources/http.html">4.5. http</a></li>
<li><a href="https://docs-next.dipdup.io/config/database.html#immune-tables">15.5. database → immune-tables</a></li>
</ul>
</div>
</div>
<h2 id="how-to-process-indexes-in-a-specific-order"><a class="header" href="#how-to-process-indexes-in-a-specific-order">How to process indexes in a specific order?</a></h2>
<p>Indexes of all kinds are fully independent. They are processed in parallel, have their own message queues, and don't share any state. It is one of the essential DipDup concepts, so there's no &quot;official&quot; way to manage the order of indexing.</p>
<p>Avoid using sync primitives like <code>asyncio.Event</code> or <code>asyncio.Lock</code> in handlers. Indexing will be stuck forever, waiting for the database transaction to complete.</p>
<p>Instead, save raw data in handlers and process it later with hooks when all conditions are met. For example, process data batch only when all indexes in the <code>dipdup_index</code> table have reached a specific level.</p>
<h2 id="how-to-perform-database-migrations"><a class="header" href="#how-to-perform-database-migrations">How to perform database migrations?</a></h2>
<p>DipDup does not provide any tooling for database migrations. The reason is that schema changes almost always imply reindexing when speaking about indexers. However, you can perform migrations yourself using any tool you like. First, disable schema hash check in config:</p>
<pre><code class="language-yaml">advanced:
  reindex:
    schema_modified: ignore
</code></pre>
<p>You can also use the <code>schema approve</code> command for a single schema change.</p>
<p>To determine what manual modifications you need to apply after changing <code>models.py</code>, you can compare raw SQL schema before and after the change.</p>
<pre><code class="language-diff">-    timestamp = fields.DatetimeField()
+    timestamp = fields.DatetimeField(auto_now=True)
</code></pre>
<pre><code class="language-shell">dipdup schema export &gt; old-schema.sql
# ...modify `models.py` here...
dipdup schema export &gt; new-schema.sql
diff old-schema.sql new-schema.sql
</code></pre>
<pre><code class="language-diff">76c76
&lt;     &quot;timestamp&quot; TIMESTAMP NOT NULL,
---
&gt;     &quot;timestamp&quot; TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,
</code></pre>
<p>Now you can prepare and execute an <code>ALTER TABLE</code> query manually or using SQL hooks.</p>
<div id="admonition-see-also-1" class="admonition info">
<div class="admonition-title">
<p>See Also</p>
<p><a class="admonition-anchor-link" href="#admonition-see-also-1"></a></p>
</div>
<div>
<ul>
<li><a href="https://docs-next.dipdup.io/advanced/reindexing.html">6.5. Reindexing</a></li>
<li><a href="https://docs-next.dipdup.io/advanced/sql.html">6.7. SQL scripts</a></li>
</ul>
</div>
</div>
<h2 id="i-get-schema_modified-error-but-i-didnt-change-anything"><a class="header" href="#i-get-schema_modified-error-but-i-didnt-change-anything">I get <code>schema_modified</code> error, but I didn't change anything</a></h2>
<p>DipDup compares the current schema hash with the one stored in the database. If they don't match, it throws an error. If models were not modified, most likely the reason is incorrect model definitions. e.g. if you define a timestamp field like this…</p>
<pre><code class="language-python">timestamp = fields.DatetimeField(default=datetime.utcnow())
</code></pre>
<p>…schema will be different every time you run DipDup, because <code>datetime.utcnow()</code> is evaluated on a module import.</p>
<pre><code class="language-diff">$ dipdup schema export &gt; schema.sql
$ dipdup schema export &gt; same-schema.sql
$ diff schema.sql same-schema.sql 
116c116
&lt;     &quot;timestamp&quot; TIMESTAMP NOT NULL  DEFAULT '2023-04-19T21:16:31.183036',
---
&gt;     &quot;timestamp&quot; TIMESTAMP NOT NULL  DEFAULT '2023-04-19T21:16:36.231221',
</code></pre>
<p>You need to make the following change in models.py:</p>
<pre><code class="language-diff">&lt;     timestamp = fields.DatetimeField(default=datetime.utcnow())
&gt;     timestamp = fields.DatetimeField(auto_now=True)
</code></pre>
<p>We plan to improve field classes in future releases to accept callables as default values.</p>
<h2 id="why-am-i-getting-decimalinvalidoperation-error"><a class="header" href="#why-am-i-getting-decimalinvalidoperation-error">Why am I getting <code>decimal.InvalidOperation</code> error?</a></h2>
<p>If your models contain <code>DecimalField</code>s, you may encounter this error when performing arithmetic operations. It's because the value is too big to fit into the current decimal context.</p>
<pre><code class="language-python">class Token(Model):
    id = fields.TextField(pk=True)
    volume = fields.DecimalField(decimal_places=18, max_digits=72)
    ...
</code></pre>
<p>Default decimal precision in Python is 28 digits. DipDup tries to increase it automatically guessing the value from the schema. It works in most cases, but not for really big numbers. You can increase the precision manually in config.</p>
<pre><code class="language-yaml">advanced:
  decimal_precision: 128
</code></pre>
<p>Don't forget to reindex after this change. When decimal context precision is adjusted you'll get a warning in the logs.</p>
<pre><code class="language-text">WARNING  dipdup.database      Decimal context precision has been updated: 28 -&gt; 128
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="deployment/monitoring.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="troubleshooting.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="deployment/monitoring.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="troubleshooting.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
